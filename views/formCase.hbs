{{#each flash}}
<div class="alert alert-{{this.type}}">{{this.message}}</div>
{{/each}}
<style>
    .relative {
        position: relative;
    }
    .right {
        right: 0;
    }
    .top {
        top: 0;
    }
    .absolute {
        position: absolute;
    }
    .cancel {
        color: tomato;
        transform: scale(2);
        cursor: pointer;
    }

    .error_input {
        border: solid 1px tomato;
    }

    input[type="checkbox"]{
        height: calc(1.5em + 0rem + 2px)
    }

    .select_status{
        width: 100%;
    }
</style>
<!-- Button trigger modal -->
{{!-- <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#modalCreatePatient">
  Agregar como paciente
</button> --}}

<!-- Modal -->
<div class="modal fade" id="modalCreatePatient" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Agregar paciente</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="form-row">
            <div class="form-group col-md-12">
                <label for="dniCreatePatient">DNI: </label>
                <input type="text" class="form-control" id="dniCreatePatient" placeholder="Número de DNI" value="">
            </div>
            <div class="form-group col-md-12">
                <label for="nameCreatePatient">Nombre: </label>
                <input type="text" class="form-control" id="nameCreatePatient" placeholder="Nombre y apellidos" value="">
            </div>
            <div class="form-group col-md-12">
                <label for="phoneCreatePatient">Celular: </label>
                <input type="text" class="form-control" id="phoneCreatePatient" placeholder="Número de celular" value="">
            </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
        <button type="button" class="btn btn-primary">Guardar</button>
      </div>
    </div>
  </div>
</div>


<div class="d-sm-flex align-items-center justify-content-between mb-4">
    <h1 class="h3 mb-0 text-gray-800">CASO</h1>
</div>
<form method="POST" id="form">
    <div class="row">
        <div class="col-xl-3 col-lg-3">
            <div class="card card-comments shadow mb-4 border-left-warning">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">Comentarios</h6>
                </div>
                <div class="card-body">
                    <ul class="case-comments ml-auto">
                        {{#each comments}}
                        <li class=" d-flex align-items-center">
                            <div>
                                <div class="small text-gray-500">{{ this.fecha_caso }}</div>
                                <span>{{ this.comentario }}</span>
                            </div>
                        </li>
                        {{/each}}
                        
                    </ul>


                </div>
            </div>

        </div>

        <div class="col-xl-6 col-lg-6">
            <div class="form-inputs-list">

                <div class="card shadow mb-4">
                    <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                        <h6 class="m-0 font-weight-bold text-primary">DATOS PACIENTE</h6>
                        <div class="call-action">
                            <a href="tel://{{celular}}" class="btn btn-success btn-circle btn-sm">
                                <i class="fas fa-phone-alt"></i>
                            </a>
                        </div>
                    </div>
                    <div class="card-body">

                        <div class="form-row">
                            <div class="form-group col-md-12">
                                <label for="inputEmail4">Paciente:</label>
                                <input type="text" class="form-control" id="nombre" name="nombre" placeholder="Nombre"
                                    disabled value="{{nombre}}">
                            </div>

                        </div>

                        <div class="form-row">
                            <div class="form-group col-md-4">
                                <label for="inputEmail4">DNI:</label>
                                <input type="text" class="form-control" name="dni" id="dni" disabled value="{{dni}}" />
                            </div>
                            <div class="form-group col-md-4">
                                <label for="inputEmail4">Teléfono</label>
                                <input type="text" class="form-control" name="celular" id="celular"
                                    value="{{celular}}" />
                            </div>
                            <div class="form-group col-md-4">
                                <label for="edad">Edad:</label>
                                <input type="text" class="form-control" name="edad" id="edad" value="{{edad}}" />
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group col-md-4">
                                <label for="pais">Pais:</label>
                                <input type="text" class="form-control" id="pais" name="pais" value="{{pais}}" />
                            </div>
                            <div class="form-group col-md-4">
                                <label for="provincia">Provincia:</label>
                                <input type="text" class="form-control" id="provincia" name="provincia" value="{{provincia}}" />
                            </div>
                            <div class="form-group col-md-4">
                                <label for="distrito">Distrito:</label>
                                <input type="text" class="form-control" id="distrito" name="distrito" value="{{distrito}}" />
                            </div>
                            <div class="form-group col-md-12">
                                <label for="direccion">Direccion:</label>
                                <input type="text" class="form-control" id="direccion" name="direccion" value="{{direccion}}" />
                            </div>
                            
                        </div>

                        <div class="form-row">
                            <div class="form-group col-md-2">
                                <label for="inputEmail4">Grupo:</label>
                                <select class="form-control" id="grupo" name="grupo">
                                    <option value="">Seleccionar</option>
                                    {{#each groups}}
                                    <option value="{{ this.id }}" {{compare this.id ../grupo "selected"}}>{{ this.id }}
                                    </option>
                                    {{/each}}
                                </select>
                            </div>
                            <div class="form-group col-md-4">
                                <label for="inputEmail4">Factor de riesgo:</label>
                                <select class="form-control" id="factor_riesgo" name="factor_riesgo">
                                    <option value="">Seleccionar</option>
                                    {{#each factors}}
                                    <option value="{{ this.id }}" {{compare this.id ../factor_riesgo "selected"}}>
                                        {{ this.descripcion }}</option>
                                    {{/each}}
                                </select>

                            </div>
                            <div class="form-group col-md-5">
                                <label for="inputEmail4">Tipo Bandeja:</label>
                                <select class="form-control" id="estado" name="estado">
                                    <option value="">Seleccionar</option>
                                    {{#each statementsPatients}}
                                    <option value="{{ this.id }}" {{compare this.id ../estado "selected"}}>
                                        {{ this.descripcion }}</option>
                                    {{/each}}
                                </select>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group col-md-4">
                                <label for="fecha_inicio_sintomas">Fecha de inicio de sintómas:</label>
                                <input class="form-control" type="date" id="fecha_inicio_sintomas"
                                    name="fecha_inicio_sintomas" value="{{ fecha_inicio_sintomas }}" />

                            </div>
                            <div class="form-group col-md-4">
                                <label for="sexo">Sexo</label>
                                <select class="form-control" id="sexo" name="sexo">
                                    <option value="">Seleccionar</option>
                                    <option value="M" {{compare sexo "M" "selected"}}>
                                        M</option>
                                    <option value="F" {{compare sexo "F" "selected"}}>
                                        F</option>
                                </select>
                            </div>
                            <div class="form-group col-md-4">
                                <label for="tiempo_seguimiento">Día de seguimiento</label>
                                <input class="form-control" type="text" id="tiempo_seguimiento"
                                    name="tiempo_seguimiento" placeholder="5" value="{{ tiempo_seguimiento }}"
                                    disabled />
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group col-md-12">
                                <label for="motivo_prueba">Motivo de prueba:</label>
                                <select class="form-control" id="motivo_prueba" name="motivo_prueba">
                                    <option value="">Seleccionar</option>
                                    {{#each testReasons}}
                                        <option value="{{ this.id }}" {{compare this.id ../id_motivo_prueba "selected"}}>
                                        {{ this.descripcion }}</option>
                                    {{/each}}
                                </select>
                            </div>
                        </div>


                        <div class="form-row">
                            <div class="form-group col-md-12">
                                {{#if tipo_prueba_1}}
                                <tr class="tr_general">
                                    <td><label for="resultado_prueba_1">Resultado de prueba 1 -
                                            {{tipo_prueba_1}}:</label></td>
                                    <td class="td_select">
                                        <select name="resultado_prueba_1" class="browser-default custom-select mb-4"
                                            id="resultado_prueba_1">
                                            <option value="">Seleccionar</option>
                                            {{#each testResults}}
                                            <option value="{{ this.id }}"
                                                {{compare this.id ../resultado_prueba_1 "selected"}}>
                                                {{ this.descripcion }}</option>
                                            {{/each}}
                                        </select>
                                    </td>
                                    <td class="td_select">
                                        <label for="fecha_resultado_prueba_1">Fecha de resultado de prueba 1 - {{tipo_prueba_1}}:</label>
                                        <input class="form-control" type="date" id="fecha_resultado_prueba_1"
                                            name="fecha_resultado_prueba_1" value="{{dateToString fecha_resultado_prueba_1}}"/>
                                    </td>
                                </tr>
                                {{/if}}
                                {{#if tipo_prueba_2}}
                                <tr class="tr_general">
                                    <td><label for="resultado_prueba_2">Resultado de prueba 2 -
                                            {{tipo_prueba_2}}:</label></td>
                                    <td class="td_select">
                                        <select name="resultado_prueba_2" class="browser-default custom-select mb-4"
                                            id="resultado_prueba_2">
                                            <option value="">Seleccionar</option>
                                            {{#each testResults}}
                                            <option value="{{ this.id }}"
                                                {{compare this.id ../resultado_prueba_2 "selected"}}>
                                                {{ this.descripcion }}</option>
                                            {{/each}}
                                        </select>
                                    </td>
                                    <td class="td_select">
                                        <label for="fecha_resultado_prueba_2">Fecha de resultado de prueba 2 -
                                            {{tipo_prueba_2}}:</label>
                                        <input class="form-control" type="date" id="fecha_resultado_prueba_2"
                                            name="fecha_resultado_prueba_2" value="{{dateToString fecha_resultado_prueba_2}}"/>
                                    </td>
                                </tr>
                                {{/if}}
                                {{#if tipo_prueba_3}}
                                <tr class="tr_general">
                                    <td><label for="textInput">Resultado de prueba 3 - {{tipo_prueba_3}}:</label></td>
                                    <td class="td_select">
                                        {{ resultado_prueba_3 }}
                                        <select name="resultado_prueba_3" class="browser-default custom-select mb-4"
                                            id="select">
                                            <option value="">Seleccionar</option>
                                            {{#each testResults}}
                                            <option value="{{ this.id }}"
                                                {{compare this.id ../resultado_prueba_3 "selected"}}>
                                                {{ this.descripcion }}</option>
                                            {{/each}}
                                        </select>
                                    </td>
                                    <td class="td_select">
                                        <label for="fecha_resultado_prueba_3">Fecha de resultado de prueba 3 - {{tipo_prueba_3}}:</label>
                                        <input class="form-control" type="date" id="fecha_resultado_prueba_3"
                                            name="fecha_resultado_prueba_3" value="{{dateToString fecha_resultado_prueba_3}}"/>
                                    </td>
                                </tr>
                                {{/if}}
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group col-md-12">
                                <label for="inputEmail4">Condición de egreso:</label>
                                <select class="form-control" id="egreso" name="condicion_egreso">
                                    <option value="">Seleccionar</option>
                                            {{#each exitConditions}}
                                            <option value="{{ this.id }}"
                                                {{compare this.id ../condicionEgreso "selected"}}>
                                                {{ this.descripcion }}</option>
                                            {{/each}}
                                </select>
                            </div>

                        </div>
                        <input type="hidden" name="tipo_guardado" id="tipo_guardado">



                    </div>
                </div>

            </div>
           
        </div>

        <div class="col-xl-3 col-lg-3">

            <div class="card  mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">Guardar</h6>
                </div>
                <div class="card-body">

                    <div class="form-group custom-switch">
                        <input type="checkbox" class="custom-control-input" name="continue_tracking" id="customSwitch1"
                            {{#if haveThisScheduledCase }} checked {{/if}} data-toggle="toggle" data-on="Si"
                            data-off="No" data-onstyle="success" data-offstyle="danger" />
                        <label class="custom-control-label" for="customSwitch1">Continuar el seguimiento</label>
                    </div>

                        <div class="form-group">
                            <label for="inputPassword">Nota de grupo:</label>
                            <textarea class="form-control" style="width: 100%;margin: 0px;padding:1%" id="comentario"
                                name="nota_grupo" maxlength="50" placeholder="Ingrese la nota de grupo">{{ nota_grupo }}</textarea>
                        </div>
                        <div class="custom-control d-flex justify-content-end">
                        <input class="btn btn-primary" type="submit" value="TERMINAR SEGUIMIENTO POR HOY"
                            onclick="document.getElementById('tipo_guardado').value=2" style="width: 200px; white-space: normal;1">
                       </div>

                </div>
            </div>


        </div>

    </div>

    <div class="row justify-content-center">
        <div class="col-xl-11 col-lg-11">
            <div class="card shadow mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">Seguimiento clínico diario del caso</h6>
                </div>
                <div class="card-body">

                    <div class="form-group row" style="flex-wrap: nowrap;padding: 1% 2%;">
                        <div style="min-width: 120px;display:flex;">
                            <ul style="padding: 0px; list-style: none;">
                                <li style="min-width: 50px; height: 50px; display:flex; justify-content: flex-start; align-items: center;">
                                    Fecha
                                </li>
                                <li style="min-width: 50px; height: 50px; display:flex; justify-content: flex-start; align-items: center;">
                                    Día
                                </li>




                                <li style="min-width: 50px; height: 50px; display:flex; justify-content: flex-start; align-items: center;">
                                    <strong>Funciones Vitales</strong>
                                </li>
                                <li style="min-width: 50px; height: 50px; display:flex; justify-content: flex-start; align-items: center;">
                                    FR
                                </li>
                                <li style="min-width: 50px; height: 50px; display:flex; justify-content: flex-start; align-items: center;">
                                    Temperatura
                                </li>
                                <li style="min-width: 50px; height: 50px; display:flex; justify-content: flex-start; align-items: center;">
                                    FC:
                                </li>
                                <li style="min-width: 50px; height: 50px; display:flex; justify-content: flex-start; align-items: center;">
                                  
                                    <div class="form-group custom-switch">
                                        <input type="checkbox" class="custom-control-input" {{#if can_plus_fv }}checked{{/if}} 
                                            data-toggle="toggle" data-on="Si" name="enabled_"
                                            data-off="No" data-onstyle="success" data-offstyle="danger" id="customSwitch02" onchange="checkboxOxi(this)" />
                                        <label class="custom-control-label" for="customSwitch02">¿Cuenta con oximetro?</label>
                                        <script>
                                            function checkboxOxi(el) {
                                                //document.getElementById("fc_fv").disabled = !el.checked;
                                                document.getElementById("sat_fv").disabled = !el.checked;
                                            }
                                        </script>
                                    </div>
                                </li>
                                <li style="min-width: 50px; height: 50px; display:flex; justify-content: flex-start; align-items: center;">
                                    SatO2:
                                </li>
                                <li style="min-width: 50px; height: 50px; display:flex; justify-content: flex-start; align-items: center;">
                                    <strong>Signos de Alarma</strong>
                                </li>
                                <li style="min-width: 50px; height: 50px; display:flex; justify-content: flex-start; align-items: center;">
                                    Disnea
                                </li>
                                <li style="min-width: 50px; height: 50px; display:flex; justify-content: flex-start; align-items: center;">
                                    Taquipnea (>= 22 pm)
                                </li>
                                <li style="min-width: 50px; height: 50px; display:flex; justify-content: flex-start; align-items: center;">
                                    {{#if (equal id_hospital 2)}}
                                        Saturación de oxígeno < 88%
                                    {{/if}}
                                    {{#if (equal id_hospital 1)}}
                                        Saturación de oxígeno < 95%
                                    {{/if}}
                                </li>
                                <li style="min-width: 50px; height: 50px; display:flex; justify-content: flex-start; align-items: center;">
                                    Alteración de la conciencia
                                </li>
                                <li style="min-width: 50px; height: 50px; display:flex; justify-content: flex-start; align-items: center;">
                                    Otros
                                </li>
                                <li style="min-width: 50px; height: 50px; display:flex; justify-content: flex-start; align-items: center;">
                                    <strong>Síntomas</strong>
                                </li>
                                <li style="min-width: 50px; height: 50px; display:flex; justify-content: flex-start; align-items: center;">
                                    Tos
                                </li>
                                <li style="min-width: 50px; height: 50px; display:flex; justify-content: flex-start; align-items: center;">
                                    Dolor de garganta
                                </li>
                                <li style="min-width: 50px; height: 50px; display:flex; justify-content: flex-start; align-items: center;">
                                    Congestión nasal
                                </li>
                                <li style="min-width: 50px; height: 50px; display:flex; justify-content: flex-start; align-items: center;">
                                    Fiebre
                                </li>
                                <li style="min-width: 50px; height: 50px; display:flex; justify-content: flex-start; align-items: center;">
                                    Malestar
                                </li>
                                <li style="min-width: 50px; height: 50px; display:flex; justify-content: flex-start; align-items: center;">
                                    Dificultad respiratoria
                                </li>
                                <li style="min-width: 50px; height: 50px; display:flex; justify-content: flex-start; align-items: center;">
                                    Diarrea
                                </li>
                                <li style="min-width: 50px; height: 50px; display:flex; justify-content: flex-start; align-items: center;">
                                    Náusea/Vómito
                                </li>
                                <li style="min-width: 50px; height: 50px; display:flex; justify-content: flex-start; align-items: center;">
                                    Cefalea
                                </li>
                                <li style="min-width: 50px; height: 50px; display:flex; justify-content: flex-start; align-items: center;">
                                    Otros
                                </li>
                                <li style="min-width: 50px; height: 50px; display:flex; justify-content: flex-start; align-items: center;">
                                    <strong style="position: absolute;">Evolución según criterios clínicos  (L=Leve; M=Moderada; S=Severa)</strong>
                                </li>
                                <li style="min-width: 50px; height: 50px; display:flex; justify-content: flex-start; align-items: center;">
                                    Estado
                                </li>
                            </ul>
                        </div>
                        <div style="width:calc(100% - 120px);overflow: auto;">
                            <div id="containet_form_check" style="display: flex;">
                                {{#each previousCases}}
                                <div style="margin: 0px 20px;">
                                    <ul style="padding: 0px; list-style: none;">
                                        <li style="min-width: 50px; height: 50px; display:flex; justify-content: center; align-items: center;"> <strong>{{ this.fecha_caso_char }}</strong></li>
                                        <li style="min-width: 50px; height: 50px; display:flex; justify-content: center; align-items: center;"> <strong>{{ this.day_index }}</strong> </li>
                                        <li style="min-width: 50px; height: 50px; display:flex; justify-content: center; align-items: center;"></li>
                                        <li style="min-width: 50px; height: 50px; display:flex; justify-content: center; align-items: center;">
                                            <input disabled style="cursor: no-drop;" class="form-control" type="number" value="{{ this.fr_fv }}"  />
                                        </li>
                                        <li style="min-width: 50px; height: 50px; display:flex; justify-content: center; align-items: center;">
                                            <input disabled style="cursor: no-drop;" class="form-control" type="number" value="{{ this.temp_fv }}"  />
                                        </li>
      
                                        <li style="min-width: 50px; height: 50px; display:flex; justify-content: center; align-items: center;">
                                            <input disabled style="cursor: no-drop;" class="form-control" type="number" value="{{ this.fc_fv }}"  />
                                        </li>
                                        <li style="min-width: 50px; height: 50px; display:flex; justify-content: center; align-items: center;"></li>
                                        <li style="min-width: 50px; height: 50px; display:flex; justify-content: center; align-items: center;">
                                            <input disabled style="cursor: no-drop;" class="form-control" type="number" value="{{ this.sat_fv }}"  />
                                        </li>

                                        <li style="min-width: 50px; height: 50px; display:flex; justify-content: center; align-items: center;"></li>
                                        <li style="min-width: 50px; height: 50px; display:flex; justify-content: center; align-items: center;">
                                            <input disabled style="cursor: no-drop;" class="form-control" type="checkbox" {{#if this.disnea_sa }}checked{{/if}}  />
                                        </li>
                                        <li style="min-width: 50px; height: 50px; display:flex; justify-content: center; align-items: center;">
                                            <input disabled style="cursor: no-drop;" class="form-control" type="checkbox" {{#if this.taqui_sa }}checked{{/if}}  />
                                        </li>
                                        <li style="min-width: 50px; height: 50px; display:flex; justify-content: center; align-items: center;">
                                            <input disabled style="cursor: no-drop;" class="form-control" type="checkbox" {{#if this.saturacion_sa }}checked{{/if}}  />
                                        </li>
                                        <li style="min-width: 50px; height: 50px; display:flex; justify-content: center; align-items: center;">
                                            <input disabled style="cursor: no-drop;" class="form-control" type="checkbox" {{#if this.alteracion_sa }}checked{{/if}}  />
                                        </li>
                                        <li style="min-width: 50px; height: 50px; display:flex; justify-content: center; align-items: center;">
                                            <input disabled style="cursor: no-drop;" class="form-control" type="checkbox" {{#if this.otros_sa }}checked{{/if}}  />
                                        </li>
                                        <li style="min-width: 50px; height: 50px; display:flex; justify-content: center; align-items: center;"></li>
                                        <li style="min-width: 50px; height: 50px; display:flex; justify-content: center; align-items: center;">
                                            <input disabled style="cursor: no-drop;" class="form-control" type="checkbox" {{#if this.tos }}checked{{/if}}  />
                                        </li>
                                        <li style="min-width: 50px; height: 50px; display:flex; justify-content: center; align-items: center;">
                                            <input disabled style="cursor: no-drop;" class="form-control" type="checkbox" {{#if this.dolor_garganta }}checked{{/if}}  />
                                        </li>
                                        <li style="min-width: 50px; height: 50px; display:flex; justify-content: center; align-items: center;">
                                            <input disabled style="cursor: no-drop;" class="form-control" type="checkbox" {{#if this.congestion_nasal }}checked{{/if}}  />
                                        </li>
                                        <li style="min-width: 50px; height: 50px; display:flex; justify-content: center; align-items: center;">
                                            <input disabled style="cursor: no-drop;" class="form-control" type="checkbox" {{#if this.fiebre }}checked{{/if}}  />
                                        </li>
                                        <li style="min-width: 50px; height: 50px; display:flex; justify-content: center; align-items: center;">
                                            <input disabled style="cursor: no-drop;" class="form-control" type="checkbox" {{#if this.malestar_general }}checked{{/if}}  />
                                        </li>
                                        <li style="min-width: 50px; height: 50px; display:flex; justify-content: center; align-items: center;">
                                            <input disabled style="cursor: no-drop;" class="form-control" type="checkbox" {{#if this.dificultad_respitar }}checked{{/if}}  />
                                        </li>
                                        <li style="min-width: 50px; height: 50px; display:flex; justify-content: center; align-items: center;">
                                            <input disabled style="cursor: no-drop;" class="form-control" type="checkbox" {{#if this.diarrea }}checked{{/if}}  />
                                        </li>
                                        <li style="min-width: 50px; height: 50px; display:flex; justify-content: center; align-items: center;">
                                            <input disabled style="cursor: no-drop;" class="form-control" type="checkbox" {{#if this.nauseas }}checked{{/if}}  />
                                        </li>
                                        <li style="min-width: 50px; height: 50px; display:flex; justify-content: center; align-items: center;">
                                            <input disabled style="cursor: no-drop;" class="form-control" type="checkbox" {{#if this.cefalea }}checked{{/if}}  />
                                        </li>
                                        <li style="min-width: 50px; height: 50px; display:flex; justify-content: center; align-items: center;">
                                            <input disabled style="cursor: no-drop;" class="form-control" type="checkbox" {{#if this.otros }}checked{{/if}}  />
                                        </li>

                                        <li style="min-width: 50px; height: 50px; display:flex; justify-content: center; align-items: center;"></li>

                                        <li style="min-width: 50px; height: 50px; display:flex; justify-content: center; align-items: center;">
                                            <select disabled class="browser-default custom-select mb-4 select_status" >
                                                {{#each ../estado_seguimiento}}
                                                    <option value="{{ this.id }}"
                                                    {{compare this.id ../estado_evo "selected"}}>
                                                    {{ this.descripcion }}</option>
                                                {{/each}}
                                            </select>
                                        </li>
                                    </ul>
                                </div>
                                {{/each}}
                                <div style="margin: 0px 20px;">
                                    <ul style="padding: 0px; list-style: none;">
                                        <li style="min-width: 50px; height: 50px; display:flex; justify-content: center; align-items: center;"> <strong>{{ to_day }}</strong></li>
                                        <li style="min-width: 50px; height: 50px; display:flex; justify-content: center; align-items: center;"> <strong>{{ tiempo_seguimiento }}</strong> </li>
                                        <li style="min-width: 50px; height: 50px; display:flex; justify-content: center; align-items: center;"></li>
                                        <li style="min-width: 50px; height: 50px; display:flex; justify-content: center; align-items: center;">
                                            <input  class="form-control" type="number"  value="{{ fr_fv }}"  name="fr_fv"  />
                                        </li>
                                        <li style="min-width: 50px; height: 50px; display:flex; justify-content: center; align-items: center;">
                                            <input  class="form-control" type="number"  value="{{ temp_fv }}"  name="temp_fv"  />
                                        </li>
                                         <li style="min-width: 50px; height: 50px; display:flex; justify-content: center; align-items: center;">
                                            <input class="form-control" type="number"  name="fc_fv" id="fc_fv" value="{{ fc_fv }}"  />
                                        </li>
                                        <li style="min-width: 50px; height: 50px; display:flex; justify-content: center; align-items: center;"></li>
                                       
                                        <li style="min-width: 50px; height: 50px; display:flex; justify-content: center; align-items: center;">
                                            <input {{#if can_plus_fv }} {{else}} disabled{{/if}}  class="form-control" type="number"  name="sat_fv" id="sat_fv" value="{{ sat_fv }}"  />
                                        </li>
                                        <li style="min-width: 50px; height: 50px; display:flex; justify-content: center; align-items: center;"></li>
                                        <li style="min-width: 50px; height: 50px; display:flex; justify-content: center; align-items: center;">
                                            <input  class="form-control" type="checkbox" {{#if disnea_sa }} checked {{/if}}  name="disnea_sa"  />
                                        </li>
                                        <li style="min-width: 50px; height: 50px; display:flex; justify-content: center; align-items: center;">
                                            <input  class="form-control" type="checkbox" {{#if taqui_sa }} checked {{/if}}  name="taqui_sa"  />
                                        </li>
                                        <li style="min-width: 50px; height: 50px; display:flex; justify-content: center; align-items: center;">
                                            <input  class="form-control" type="checkbox" {{#if saturacion_sa }} checked {{/if}}  name="saturacion_sa"  />
                                        </li>
                                        <li style="min-width: 50px; height: 50px; display:flex; justify-content: center; align-items: center;">
                                            <input  class="form-control" type="checkbox" {{#if alteracion_sa }} checked {{/if}}  name="alteracion_sa"  />
                                        </li>
                                        <li style="min-width: 50px; height: 50px; display:flex; justify-content: center; align-items: center;">
                                            <input  class="form-control" type="checkbox" {{#if otros_sa }} checked {{/if}}  name="otros_sa"  />
                                        </li>
                                        <li style="min-width: 50px; height: 50px; display:flex; justify-content: center; align-items: center;"></li>
                                        <li style="min-width: 50px; height: 50px; display:flex; justify-content: center; align-items: center;">
                                            <input  class="form-control" type="checkbox" {{#if tos }} checked {{/if}}  name="tos"  />
                                        </li>
                                        <li style="min-width: 50px; height: 50px; display:flex; justify-content: center; align-items: center;">
                                            <input  class="form-control" type="checkbox" {{#if dolor_garganta }} checked {{/if}}  name="dolor_garganta"  />
                                        </li>
                                        <li style="min-width: 50px; height: 50px; display:flex; justify-content: center; align-items: center;">
                                            <input  class="form-control" type="checkbox" {{#if congestion_nasal }} checked {{/if}}  name="congestion_nasal"  />
                                        </li>
                                        <li style="min-width: 50px; height: 50px; display:flex; justify-content: center; align-items: center;">
                                            <input  class="form-control" type="checkbox" {{#if fiebre }} checked {{/if}}  name="fiebre"  />
                                        </li>
                                        <li style="min-width: 50px; height: 50px; display:flex; justify-content: center; align-items: center;">
                                            <input  class="form-control" type="checkbox" {{#if malestar_general }} checked {{/if}}  name="malestar_general"  />
                                        </li>
                                        <li style="min-width: 50px; height: 50px; display:flex; justify-content: center; align-items: center;">
                                            <input  class="form-control" type="checkbox" {{#if dificultad_respitar }} checked {{/if}}  name="dificultad_respitar"  />
                                        </li>
                                        <li style="min-width: 50px; height: 50px; display:flex; justify-content: center; align-items: center;">
                                            <input  class="form-control" type="checkbox" {{#if diarrea }} checked {{/if}}  name="diarrea"  />
                                        </li>
                                        <li style="min-width: 50px; height: 50px; display:flex; justify-content: center; align-items: center;">
                                            <input  class="form-control" type="checkbox" {{#if nauseas }} checked {{/if}}  name="nauseas"  />
                                        </li>
                                        <li style="min-width: 50px; height: 50px; display:flex; justify-content: center; align-items: center;">
                                            <input  class="form-control" type="checkbox" {{#if cefalea }} checked {{/if}}  name="cefalea"  />
                                        </li>
                                        <li style="min-width: 50px; height: 50px; display:flex; justify-content: center; align-items: center;">
                                            <input  class="form-control" type="checkbox" {{#if otros }} checked {{/if}}  name="otros"  />
                                        </li>

                                        <li style="min-width: 50px; height: 50px; display:flex; justify-content: center; align-items: center;"></li>

                                        <li style="min-width: 50px; height: 50px; display:flex; justify-content: center; align-items: center;">
                                            <select name="estado_evo" class="browser-default custom-select mb-4 select_status">
                                                {{#each monitoringStatus}}
                                                    <option value="{{ this.id }}"
                                                        {{compare this.id ../estado_evo "selected"}}>
                                                        {{ this.descripcion }}</option>
                                                {{/each}}
                                            </select>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
        <div class="col-xl-11 col-lg-11">
            <div class="card shadow mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">Medicación  reportada por paciente</h6>
                    <p class="h6 m-3 text-danger">IMPORTANTE: Al momento no existe un tratamiento que tenga beneficio probado en el manejo ambulatorio de COVID-19. 
Se aconseja desalentar la automedicación y monitorear eventos adversos si es que alguna de estas medicinas han sido prescritas por un médico.</p>
                </div>
                <div class="card-body">

                    <div class="form-group">
                        <div class="form-row">
                            <div class="form-group col-md-12">
                                <select id="combo_box_tratamiento" class="browser-default custom-select mb-2" >
                                </select>
                                <input id="button_agregar_tratamiento" type="button" class="btn btn-primary bg-primary" value="Registrar  medicamento">
                            </div>

                            <div class="form-group col-md-12" id="container_treatments">
                                
                            </div>

                        </div>
                    </div>

                </div>
            </div>

        </div>
        <div class="col-xl-11 col-lg-11">
            <div class="card shadow mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">Contactos Intradomiciliarios</h6>
                </div>
                <div class="card-body">

                    <div class="form-group">
                        <div class="form-row">
                            <div class="form-group col-md-12">
                                <input id="text_box_contacto" class="browser-default mb-2 form-control" type="text" placeholder="Ingrese DNI"/>
                                <input id="button_agregar_contacto" type="button" class="btn btn-primary bg-primary" value="Agregar Contactos Intradomiciliarios">
                            </div>

                            <div class="form-group col-md-12" id="container_contact">

                                
                            </div>

                        </div>
                    </div>

                </div>
            </div>
            
        </div>
        <div class="col-xl-11 col-lg-11">
            <div class="card shadow mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">Comentario</h6>
                </div>
                <div class="card-body">

                    <div class="form-group">


                        <textarea class="form-control" style="width: 100%;margin: 0px;padding:1%" id="comentario"
                            name="comentario" placeholder="Ingrese sus comentarios" >{{ comentario }}</textarea>
                    </div>


                </div>
            </div>
            
        </div>
        <div class="col-xl-11 col-lg-11">
            <div class="form-group d-flex justify-content-between" style="flex-wrap:wrap">
                <input class="btn btn-success" type="submit" value="VOY A SEGUIRLO MÁS TARDE" onclick="document.getElementById('tipo_guardado').value=1; submitFormCustom()" style="margin:3%;width: 200px; white-space: normal;">
                <input class="btn btn-warning" type="submit" value="QUE ALGUIEN MÁS LO SIGA HOY" onclick="document.getElementById('tipo_guardado').value=3; submitFormCustom()" style="margin:3%;width: 200px; white-space: normal;1">
            </div>
        </div>
    </div>

</form>
<script>

    const options = {
        "1": {
            "name": "Hidroxicloroquina",
            "life": 1
        },
        "2": {
            "name": "Azitromicina",
            "life": 1
        },
        "3": {
            "name": "Prednisona",
            "life": 1
        },
        "4": {
            "name": "Enoxaheparina",
            "life": 1
        },
        "5": {
            "name": "Aspirina",
            "life": 1
        },
        "6": {
            "name": "Warfarina",
            "life": 1
        },
        "7": {
            "name": "Ivermectina",
            "life": 1
        },
        "8": {
            "name": "Dióxido de cloro",
            "life": 1
        },
        "100": {
            "name": "Otros",
            "life": 1000
        }
    }

    var countInputsNone = 0

    function arrayJsonToTreatmentsStruct(array){
        let json = {}
        for(let item of array){
            json[item.id] = item
        }
        return json
    }

    const treatments = arrayJsonToTreatmentsStruct(JSON.parse(`{{{ treatmentsString }}}`))

    function printOptions(el, options){
        let html = ''
        for(let option in options){
            if(options[option].life > 0)
                html+= `<option value="${option}">${options[option].name}</option>`
        }
        el.innerHTML = html
    }

    function substractLife(id, life=1){
        options[id].life = options[id].life - life
    }

    function plusLife(id, life=1){
        options[id].life = options[id].life + life
    }

    function normalizerOptions(){
        for(let key in treatments){
            let treatment = treatments[key]
            let id = treatment.type //ID de tratamiento (Al mismo tiempo es el tipo de tratamiento)
            if(options[id]){
                substractLife(id, life=1)
            }
        }
    }

    function checkboxCurrentTreatment(el, idElementTarget) {
        document.getElementById(idElementTarget).disabled = el.checked;
    }

    function printTreatments(el){
        
        let html = ''
        
        for(let key in treatments){
            let treatment = treatments[key]
            let card_head = `<div class="card-header py-3">
                                <input type="hidden" id="input_tra_${key}_name" name="input_tra_${key}_name" value="${treatment.name}"/>
                                <p class="m-0 font-weight-bold text-primary">${treatment.name}</p>
                                <i class="fas fa-times-circle top right absolute cancel" onclick="remove_treatment('${key}', ${treatment.type})"></i>
                            </div>`;
            if(treatment.type == 100)
                card_head = `<div class="card-header py-3 form-inline">
                                <label for="" class="m-0 font-weight-bold text-primary mr-2">Otros : </label>
                                <input class="form-control col-md-5" id="input_tra_${key}_name" name="input_tra_${key}_name" type="text" value="${treatment.name}" />
                                <i class="fas fa-times-circle top right absolute cancel" onclick="remove_treatment('${key}', ${treatment.type})"></i>
                            </div>`

            let card = `<div class="card shadow mb-4 relative">
                            <input type="hidden" id="input_tra_${key}_type" name="input_tra_${key}_type" value="${treatment.type}"/>
                            <input type="hidden" id="input_tra_${key}_id" name="input_tra_${key}_id" value="${key}"/>
                            ${card_head}
                            <div class="card-body">
                                <div class="form-inline mb-2">
                                    <div class="form-group col-md-5">
                                        <label for="">Fecha de inicio :</label>
                                        <input class="form-control col-11" id="input_tra_${key}_from" name="input_tra_${key}_from" type="date" value="${treatment.init}" />
                                    </div>
                                    <div class="form-group col-md-5">
                                        <label for="">Fecha de fin :</label>
                                        <input class="form-control col-11" ${treatment.using? "disabled" : ""} type="date" id="input_tra_${key}_to" name="input_tra_${key}_to" value="${treatment.finish}" />
                                    </div>
                                    <div class="form-group custom-switch col-md-2">
                                        <input type="checkbox" class="custom-control-input" onchange="checkboxCurrentTreatment(this, 'input_tra_${key}_to')" name="input_tra_${key}_currentusing" id="input_tra_${key}_currentusing"
                                            data-toggle="toggle" ${treatment.using? "checked" : ""} data-on="Si" data-off="No" data-onstyle="success" data-offstyle="danger"/>
                                        <label class="custom-control-label" for="input_tra_${key}_currentusing">Actualmente en uso</label>
                                    </div>
                                </div>
                                <div class="form-group col-md-12">
                                    <label for="">Observaciones :</label>
                                    <textarea class="form-control" style="width: 100%;margin: 0px;padding:1%"
                                        id="input_tra_${key}_obs" name="input_tra_${key}_obs" placeholder="Ingrese sus comentarios" maxlength="50" >${treatment.observation == null ? "": treatment.observation }</textarea>
                                </div>


                                <div class="form-row">
                                    <div class="form-group col-md-6">
                                        <label for="input_tra_${key}_rea">Motivo uso:</label>
                                        <select class="form-control col-11" id="input_tra_${key}_rea" name="input_tra_${key}_rea" onchange="enabledByOption('input_tra_${key}_rea', 'input_tra_${key}_det_container', 2)">
                                            <option value="">Seleccionar</option>
                                            <option value="1" ${treatment.reason == 1 ? "selected": "" }>Uso por indicación médica (receta médica)</option>
                                            <option value="2" ${treatment.reason == 2 ? "selected": "" }>Automedicación</option>
                                        </select>
                                    </div>
                                     <div class="form-group col-md-6" style="${treatment.reason != 2 ? "display:none": "" }" id="input_tra_${key}_det_container">
                                        <label for="input_tra_${key}_det">Detalle del uso:</label>
                                        <select ${treatment.reason != 2 ? "disabled": "" } class="form-control col-11" id="input_tra_${key}_det" name="input_tra_${key}_det">
                                            <option value="">Seleccionar</option>
                                            <option value="1" ${treatment.detail == 1 ? "selected": "" }>Consultó con un farmacéutico</option>
                                            <option value="2" ${treatment.detail == 2 ? "selected": "" }>Consultó con familiares/amigos</option>
                                            <option value="3" ${treatment.detail == 3 ? "selected": "" }>Lo tomó a criterio personal</option>
                                            <option value="4" ${treatment.detail == 4 ? "selected": "" }>Otro</option>
                                        </select>
                                    </div>
                                </div>

                                    
                            </div>
                        </div>`
            html+=card
        }

        el.innerHTML = html
    }

    function enabledByOption(idElement, toIdElement, value) {
        element = document.getElementById(idElement);
        toElement = document.getElementById(toIdElement);
        toElementSelect = toElement.querySelector("select");
        if (element.value == value) {
            toElement.style.display = "block";
            toElementSelect.disabled = false;
        } else {
            toElement.style.display = "none";
            toElementSelect.disabled = true;
        }
    }

    function saveState(){
        for(let key in treatments){
            let name = document.getElementById(`input_tra_${key}_name`).value
            let init = document.getElementById(`input_tra_${key}_from`).value
            let finish = document.getElementById(`input_tra_${key}_to`).value
            let observation = document.getElementById(`input_tra_${key}_obs`).value
            treatments[key].name = name
            treatments[key].init = init
            treatments[key].finish = finish
            treatments[key].observation = observation
        }
    }

    function remove_treatment(key, type){
        saveState()
        plusLife(type)
        delete treatments[key]
        printTreatments(container_treatments)
        printOptions(combo_box_tratamiento, options)
    }

    function add_treatment(key, type, name=""){
        treatments[key] = {
            type: type,
            name: name,
            init: "",
            finish: "",
            observation: "",
            reason: null,
            detail: null,
            using: false
        }
    }
    
    function init_treatments (){
        const combo_box_tratamiento = document.getElementById("combo_box_tratamiento")
        const button_agregar_tratamiento = document.getElementById("button_agregar_tratamiento")
        const container_treatments = document.getElementById("container_treatments")
        normalizerOptions()
        printOptions(combo_box_tratamiento, options)
        printTreatments(container_treatments)
        button_agregar_tratamiento.addEventListener("click", ()=>{
            saveState()
            let id = combo_box_tratamiento.value
            let name = combo_box_tratamiento.selectedOptions[0].text
            substractLife(id)
            let key = "none" + countInputsNone
            countInputsNone++
            debugger
            add_treatment(key, id, name)
            printOptions(combo_box_tratamiento, options)
            printTreatments(container_treatments)
        })
    }

</script>
<script>

    

    var countInputsNoneContact = 0
    var container_contact
    const contacts = JSON.parse(`{{{ contactsString }}}`)
    const monitor_options = ["", "A", "S","H", "F", "L"]
    const seguimiento_options = {
        "0":"NO", 
        "1":"PACIENTE", 
        "2":"MI CONTACTO",
        "3":"CONTACTO DE OTRO PACIENTE"
    }

    function remove_contact(key){
        saveStatusContacts() //Guardar el estado de los inputs para volver a generar HTML
        delete contacts[key]
        generateCardContact(container_contact)
    }

    function add_contact(key, data=null){
        debugger;
        saveStatusContacts() //Guardar el estado de los inputs para volver a generar HTML
        if(data)
            contacts[key] = data
        else
            contacts[key] = {
                "dni": "",
                "edad": "",
                "factor_riesgo": false,
                "seguimiento": false,
                "nombre": "",
                "observacion": "",
                "parentesco": "",
                "dia": 2,
                "celular": "",
                "monitoreo": "",
                "monitoreos": [],
                "tipo_prueba_1": "",
                "resultado_prueba_1": "",
                "fecha_resultado_prueba_1": "",
                "tipo_prueba_2": "",
                "resultado_prueba_2": "",
                "fecha_resultado_prueba_2": "",
                "tipo_prueba_3": "",
                "resultado_prueba_3": "",
                "fecha_resultado_prueba_3": ""
            }
        generateCardContact(container_contact)
    }
    
    function saveStatusContacts() {
        
        for (let key in contacts) {
            
            let name = document.getElementById(`input_cont_${key}_name`).value;
            
            //let dni = document.getElementById(`input_cont_${key}_dni`).value
            
            let age = document.getElementById(`input_cont_${key}_age`).value;
            
            let factor = document.getElementById(`input_cont_${key}_factor`).value;
            
            let observation = "";
            
            if(contacts[key].observacion && document.getElementById(`input_cont_${key}_obs`))
                observation = document.getElementById(`input_cont_${key}_obs`).value;
            
            let parent = document.getElementById(`input_cont_${key}_parent`).value;
            
            //let follow = document.getElementById(`input_cont_${key}_follow`).value

            let phone = document.getElementById(`input_cont_${key}_phone`).value;
            

            let monitor = document.getElementById(`input_cont_${key}_monitor`) ? document.getElementById(`input_cont_${key}_monitor`).value : "";

            
            
            contacts[key]["edad"] = age
            contacts[key]["monitoreo"] = monitor
            contacts[key]["factor_riesgo"] = factor
            contacts[key]["nombre"] = name
            contacts[key]["celular"] = phone
            
            if(contacts[key].observacion)
                contacts[key]["observacion"] = observation
            //contacts[key]["seguimiento"] = follow
            contacts[key]["parentesco"] = parent
        }
    }
    
    function validateOptionMonitoreo(key){
        let html = ''
        for(let item of monitor_options){
            html+= key != null && item == key.toUpperCase() ? `<option value="${item}" selected>${item}</option>` : `<option value="${item}">${item}</option>`
        }
        return html
    }

    function validateOptionSeguimiento(key){
        let html = ''
        for(let _key in seguimiento_options){
            let item = seguimiento_options[_key]
            html+= key != null && _key == key? `<option value="${_key}" selected>${item}</option>` : `<option value="${_key}">${item}</option>`
        }
        return html
    }

    function generateCardContact(el){
        let html = '' //Texto base para almacenar HTML en texto
        
        //Iterar JSON por KEY
        for(let key in contacts){
            let contact = contacts[key] //Obtener Elemento "Contact" desde JSON
            console.log(contact)
            //let follow = validateOptionSeguimiento(contact.seguimiento)
            //let follow = contact.seguimiento ? `<option value="NO">NO</option><option value="SI" selected>SI</option>` : `<option value="NO" selected>NO</option><option value="SI">SI</option>`
            let factor = contact.factor_riesgo ? `<option value="NO">NO</option><option value="SI" selected>SI</option>` : `<option value="NO" selected>NO</option><option value="SI">SI</option>`
            
            let factor_text = contact.factor_riesgo ? 'SI': 'NO'
            contact.nombre = contact.nombre ? contact.nombre : ""
            contact.edad = contact.edad ? contact.edad : "" 
            contact.observacion = contact.observacion ? contact.observacion : "" 
            contact.parentesco = contact.parentesco ? contact.parentesco : "" 
            let html_name = contact.seguimiento == 0 || contact.seguimiento == 2 ? 
                        `<input  required class="form-control col-md-11" id="input_cont_${key}_name" name="input_cont_${key}_name" type="text" value="${contact.nombre}" />`:
                            `<input disabled required class="form-control col-md-11" type="text" value="${contact.nombre}" />
                            <input id="input_cont_${key}_name" name="input_cont_${key}_name" type="hidden" value="${contact.nombre}" />`
            //|| contact.edad == null || contact.edad == ""
            let html_age = contact.seguimiento == 0 || contact.seguimiento == 2 ? 
                        `<input required class="form-control col-md-11" id="input_cont_${key}_age" name="input_cont_${key}_age" type="text" value="${contact.edad}" />`:
                        `<input required disabled class="form-control col-md-11" type="text" value="${contact.edad}" />
                        <input  id="input_cont_${key}_age" name="input_cont_${key}_age" type="hidden" value="${contact.edad}" />`
            let html_factor = contact.seguimiento == 0 || contact.seguimiento == 2 ? 
                        `<select required id="input_cont_${key}_factor" name="input_cont_${key}_factor" class="browser-default custom-select col-md-11 form-control">
                                        ${factor}
                         </select>`:
                        `<input type="hidden" value="${factor_text}" id="input_cont_${key}_factor" name="input_cont_${key}_factor" />
                        <select disabled  class="browser-default custom-select col-md-11 form-control">
                                        ${factor}
                         </select>`
            let html_observacion = contact.seguimiento == 0 || contact.seguimiento == 2 ? 
                                    `<div class="form-group col-md-12">
                                        <label for="">Observaciones :</label>
                                        <textarea class="form-control" style="width: 100%;margin: 0px;padding:1%"
                                        id="input_cont_${key}_obs" name="input_cont_${key}_obs" placeholder="Ingrese sus observaciones" maxlength="50" >${contact.observacion}</textarea>
                                    </div>`: contact.seguimiento == 1 ? '':
                                    `<div class="form-group col-md-12">
                                        <label for="">Observaciones :</label>
                                        <input type="hidden" value="${contact.observacion}" id="input_cont_${key}_obs" name="input_cont_${key}_obs" />
                                        <textarea disabled class="form-control" style="width: 100%;margin: 0px;padding:1%"
                                         placeholder="Ingrese sus observaciones" maxlength="50" >${contact.observacion}</textarea>
                                    </div>`
            
            let last_monitors = '' //Texto base para almacenar Combos Boxs anteriores
            
            //Generar HTML TEXTO de combo box de monitoreos pasados
            for(let monitor of contact.monitoreos){
                let _html = validateOptionMonitoreo(monitor.monitoreo) //Validar Options de monitoreo segun KEY [  | A | S | H | F]
                last_monitors += `<div style="margin: 0px 20px;">
                                    <ul style="padding: 0px; list-style: none;">
                                        <li style="min-width: 50px; height: 50px; display:flex; justify-content: center; align-items: center;"> <strong>Condición - día ${monitor.dia}</strong></li>
                                        <li style="min-width: 50px; height: 50px; display:flex; justify-content: center; align-items: center;">
                                            <select disabled class="browser-default custom-select mb-4">
                                                ${_html}
                                            </select>
                                        </li>
                                    </ul>
                                </div>`
            }

            let monitor = validateOptionMonitoreo(contact.monitoreo) //Options validados segun KEY [  | A | S | H | F | L]

            let _html_monitor_input =  contact.seguimiento == 0 || contact.seguimiento == 2 ? 
                                `<div style="margin: 0px 20px;">
                                    <ul style="padding: 0px; list-style: none;">
                                        <li style="min-width: 50px; height: 50px; display:flex; justify-content: center; align-items: center;"> <strong>Condición - día ${contact.dia}</strong></li>
                                        <li style="min-width: 50px; height: 50px; display:flex; justify-content: center; align-items: center;">
                                            <select id="input_cont_${key}_monitor" name="input_cont_${key}_monitor" class="browser-default custom-select mb-4">
                                                ${monitor}
                                            </select>
                                        </li>
                                    </ul>
                                </div>`:""

            let _html_monitor = `<div class="form-group row" style="flex-wrap: nowrap;padding: 1% 2%;overflow: auto;">
                                ${last_monitors}
                                ${_html_monitor_input}
                            </div>
                            <label for="" class="m-0 font-weight-bold text-primary">(Vacío=Pendiente; A=Asintomático; S=Sintomático; H=Hospitalizado; F=Fallecido; L=Alta)</label>`
            _html_monitor = contact.seguimiento == 1 && contact.monitoreos.lenght == 0 ? "" : _html_monitor;
            const htmlFollowAddPatient = contact.seguimiento != 1 ? `<br/><br/>
                            <button type="button" class="btn btn-primary" onclick="addPatient('${key}')">
                                Agregar como paciente
                            </button>
                            <div class="col-md-1"></div>` : ``;
            let html_follow = contact.seguimiento == 3 && key.indexOf("none") == -1 ?
                            `<div class="col-md-12" style="padding: 0px;">
                                <label for="" style="text-align: start;display: block;">¿Seguimiento por plataforma?</label>
                            </div>
                            <input disabled id="input_cont_${key}_follow" name="input_cont_${key}_follow" class="form-control col-md-12" type="text" value="${seguimiento_options[contact.seguimiento]}" />
                            ${htmlFollowAddPatient}
                            <div class="form-group custom-switch col-md-5">
                                <input type="checkbox" class="custom-control-input" name="input_cont_${key}_have_control" id="input_cont_${key}_have_control"
                                    data-toggle="toggle" data-on="Si" data-off="No" data-onstyle="success" data-offstyle="danger" onclick="takeContact(this, '${contact.dni}', '{{dni}}')"/>
                                <label class="custom-control-label" for="input_cont_${key}_have_control">¿Tomar contacto?</label>
                            </div>`:
                            `<label for="">¿Seguimiento por plataforma?</label>
                            <input disabled id="input_cont_${key}_follow" name="input_cont_${key}_follow" class="form-control col-md-11" type="text" value="${seguimiento_options[contact.seguimiento]}" />
                            ${htmlFollowAddPatient}`;
            const html_test = contact.seguimiento != 1 ? '' :`
            <div class="form-inline mb-2">
                <div class="form-group col-md-4">
                    <label  for="input_cont_${key}_tipoprueba1&${contact.dni}">Tipo de muestra 1:</label>
                    <select id="input_cont_${key}_tipoprueba1&${contact.dni}" name="input_cont_${key}_tipoprueba1&${contact.dni}" class="browser-default custom-select col-md-11 form-control">
                            <option value="">-</option>
                            <option ${contact.tipo_prueba_1 == "ANTIGENO" ? "selected" : ""} value="ANTIGENO">ANTIGENO</option>
                            <option ${contact.tipo_prueba_1 == "MOLECULAR" ? "selected" : ""} value="MOLECULAR">MOLECULAR</option>
                            <option ${contact.tipo_prueba_1 == "RAPIDA" ? "selected" : ""} value="RAPIDA">RAPIDA</option>
                    </select>
                </div>
                <div class="form-group col-md-4">
                    <label  for="input_cont_${key}_fecharesultadoprueba1&${contact.dni}">Fecha de resultado de prueba 1:</label>
                    <input class="col-md-11 form-control" type="date" id="input_cont_${key}_fecharesultadoprueba1&${contact.dni}"
                                            name="input_cont_${key}_fecharesultadoprueba1&${contact.dni}" value="${contact.fecha_resultado_prueba_1 == null? "": contact.fecha_resultado_prueba_1.substring(0, 10)}"/>
                </div>
                <div class="form-group col-md-4">
                    <label  for="input_cont_${key}_resultadoprueba1&${contact.dni}">Resultado de muestra 1:</label>
                    <select id="input_cont_${key}_resultadoprueba1&${contact.dni}" name="input_cont_${key}_resultadoprueba1&${contact.dni}" class="browser-default custom-select col-md-11 form-control">
                            <option ${contact.resultado_prueba_1 == 3 ? "selected" : ""} value="3">PENDIENTE</option>
                            <option ${contact.resultado_prueba_1 == 2 ? "selected" : ""} value="2">POSITIVO</option>
                            <option ${contact.resultado_prueba_1 == 1 ? "selected" : ""} value="1">NEGATIVO</option>
                    </select>
                </div>
            </div>
            
            <div class="form-inline mb-2">
                <div class="form-group col-md-4">
                    <label  for="input_cont_${key}_tipoprueba2&${contact.dni}">Tipo de muestra 2:</label>
                    <select id="input_cont_${key}_tipoprueba2&${contact.dni}" name="input_cont_${key}_tipoprueba2&${contact.dni}" class="browser-default custom-select col-md-11 form-control">
                            <option value="">-</option>
                            <option ${contact.tipo_prueba_2 == "ANTIGENO" ? "selected" : ""} value="ANTIGENO">ANTIGENO</option>
                            <option ${contact.tipo_prueba_2 == "MOLECULAR" ? "selected" : ""} value="MOLECULAR">MOLECULAR</option>
                            <option ${contact.tipo_prueba_2 == "RAPIDA" ? "selected" : ""} value="RAPIDA">RAPIDA</option>
                    </select>
                </div>
                <div class="form-group col-md-4">
                    <label  for="input_cont_${key}_fecharesultadoprueba2&${contact.dni}">Fecha de resultado de prueba 2:</label>
                    <input class="col-md-11 form-control" type="date" id="input_cont_${key}_fecharesultadoprueba2&${contact.dni}"
                                            name="input_cont_${key}_fecharesultadoprueba2&${contact.dni}" value="${contact.fecha_resultado_prueba_2 == null? "": contact.fecha_resultado_prueba_2.substring(0, 10)}"/>
                </div>
                <div class="form-group col-md-4">
                    <label  for="input_cont_${key}_resultadoprueba2&${contact.dni}">Resultado de muestra 2:</label>
                    <select id="input_cont_${key}_resultadoprueba2&${contact.dni}" name="input_cont_${key}_resultadoprueba2&${contact.dni}" class="browser-default custom-select col-md-11 form-control">
                            <option ${contact.resultado_prueba_2 == 3 ? "selected" : ""} value="3">PENDIENTE</option>
                            <option ${contact.resultado_prueba_2 == 2 ? "selected" : ""} value="2">POSITIVO</option>
                            <option ${contact.resultado_prueba_2 == 1 ? "selected" : ""} value="1">NEGATIVO</option>
                    </select>
                </div>
            </div>
            
            
            <div class="form-inline mb-2">
                <div class="form-group col-md-4">
                    <label  for="input_cont_${key}_tipoprueba3&${contact.dni}">Tipo de muestra 3:</label>
                    <select id="input_cont_${key}_tipoprueba3&${contact.dni}" name="input_cont_${key}_tipoprueba3&${contact.dni}" class="browser-default custom-select col-md-11 form-control">
                            <option value="">-</option>
                            <option ${contact.tipo_prueba_3 == "ANTIGENO" ? "selected" : ""} value="ANTIGENO">ANTIGENO</option>
                            <option ${contact.tipo_prueba_3 == "MOLECULAR" ? "selected" : ""} value="MOLECULAR">MOLECULAR</option>
                            <option ${contact.tipo_prueba_3 == "RAPIDA" ? "selected" : ""} value="RAPIDA">RAPIDA</option>
                    </select>
                </div>
                <div class="form-group col-md-4">
                    <label  for="input_cont_${key}_fecharesultadoprueba3&${contact.dni}">Fecha de resultado de prueba 3:</label>
                    <input class="col-md-11 form-control" type="date" id="input_cont_${key}_fecharesultadoprueba3&${contact.dni}"
                                            name="input_cont_${key}_fecharesultadoprueba3&${contact.dni}" value="${contact.fecha_resultado_prueba_3 == null? "": contact.fecha_resultado_prueba_3.substring(0, 10)}"/>
                </div>
                <div class="form-group col-md-4">
                    <label  for="input_cont_${key}_resultadoprueba3&${contact.dni}">Resultado de muestra 3:</label>
                    <select id="input_cont_${key}_resultadoprueba3&${contact.dni}" name="input_cont_${key}_resultadoprueba3&${contact.dni}" class="browser-default custom-select col-md-11 form-control">
                            <option ${contact.resultado_prueba_3 == 3 ? "selected" : ""} value="3">PENDIENTE</option>
                            <option ${contact.resultado_prueba_3 == 2 ? "selected" : ""} value="2">POSITIVO</option>
                            <option ${contact.resultado_prueba_3 == 1 ? "selected" : ""} value="1">NEGATIVO</option>
                    </select>
                </div>
            </div>`
            html+=`<div class="card shadow mb-4 relative">
                        <input type="hidden" id="input_cont_${key}_id" name="input_cont_${key}_id" value="${key}"/>
                        <div class="card-header py-3 form-inline">
                            <div class="form-group col-md-6">
                                    <label for="" class="m-0 font-weight-bold text-primary">Parentesco :</label>
                                    <input required class="form-control col-md-11" id="input_cont_${key}_parent" name="input_cont_${key}_parent" type="text" value="${contact.parentesco}" />
                            </div>
                            <div class="form-group col-md-6">
                                    <label for="" class="m-0 font-weight-bold text-primary">Nombre :</label>
                                    ${html_name}
                            </div>
                            <i class="fas fa-times-circle top right absolute cancel" onclick="remove_contact('${key}')"></i>
                        </div>
                        <div class="card-body">
                            <div class="form-inline mb-2">
                                <div class="form-group col-md-6">
                                    ${html_follow}
                                </div>

                                <div class="form-group col-md-6">
                                    <label for="">DNI :</label><div class="col-md-1"></div>
                                    <input required type="hidden" id="input_cont_${key}_dni" name="input_cont_${key}_dni" value="${contact.dni}" />
                                    <input disabled class="form-control col-md-11" type="text"  value="${contact.dni}" />
                                </div>
                            </div>
                            <div class="form-inline mb-2">
                                <div class="form-group col-md-6">
                                    <label for="">Edad :</label><div class="col-md-1"></div>
                                    ${html_age}
                                </div>

                                <div class="form-group col-md-6">
                                    <label for="">Factor de riesgo :</label>
                                    ${html_factor}
                                </div>
                            </div>
                            <div class="form-inline mb-2">
                                <div class="form-group col-md-6">
                                    <label for="input_cont_${key}_phone">Celular :</label><div class="col-md-1"></div>
                                    <input required class="form-control col-md-11" id="input_cont_${key}_phone" name="input_cont_${key}_phone" type="text" value="${contact.celular}" />
                                </div>

                                
                            </div>
                            ${html_test}
                            ${html_observacion}
                            ${_html_monitor}
                        </div>
                    </div>`
        }
        el.innerHTML = html
    }

    async function addPatient(dniContact){
        const inputDni = document.getElementById(`input_cont_${dniContact}_dni`);
        const inputName = document.getElementById(`input_cont_${dniContact}_name`);
        const inputPhone = document.getElementById(`input_cont_${dniContact}_phone`);
        const inputAge = document.getElementById(`input_cont_${dniContact}_age`);
        const inputFactor = document.getElementById(`input_cont_${dniContact}_factor`);
        if (!(inputDni && inputDni.value != null && inputDni.value != '')) {
            Swal.fire({
                icon: 'error',
                title: 'DNI necesario',
                text: 'Es necesario el DNI para crear al paciente.',
            });
            return;
        }
        if (!(inputName && inputName.value != null && inputName.value != '')) {
            Swal.fire({
                icon: 'error',
                title: 'Nombre necesario',
                text: 'Es necesario el NOMBRE para crear al paciente.',
            });
            return;
        }
        if (!(inputPhone && inputPhone.value != null && inputPhone.value != '')) {
            Swal.fire({
                icon: 'error',
                title: 'CELULAR necesario',
                text: 'Es necesario el número de CELULAR para crear al paciente.',
            });
            return;
        }
        if (!(inputAge && inputAge.value != null && inputAge.value != '')) {
            Swal.fire({
                icon: 'error',
                title: 'Nombre necesario',
                text: 'Es necesario la Edad para crear al paciente.',
            });
            return;
        }
        const body = {
            "dni": inputDni.value,
            "nombre": inputName.value,
            "celular": inputPhone.value,
            "edad": inputAge.value,
            "factor": inputFactor.value.toUpperCase() == 'SI'? true : false,
            "dniPaciente": "{{dni}}"
        }
        Swal.fire({
            'imageUrl': 'https://i.pinimg.com/originals/7e/fc/2c/7efc2cb33ee4eb9d7625ca1eca702506.gif',
            'title': 'Espere un momento.'
            })
        fetch(`/api/v1/ajax/patient/add`,{
            method:"POST",
            headers:{"content-type": "application/json"},
            body:JSON.stringify(body),
        }).then(async (data)=>{
            Swal.close();
            const json = await data.json();
            if (json.success) {
                remove_contact(dniContact)
                const text_box_contacto = document.getElementById("text_box_contacto");
                const button_agregar_contacto = document.getElementById("button_agregar_contacto");
                const tempValue = text_box_contacto.value;
                text_box_contacto.value = inputDni.value;
                button_agregar_contacto.click();
                text_box_contacto.value = tempValue;
            }
        }).catch((err)=>{
            Swal.close();
        })
    }

    async function takeContact(el, dni_contact, dni_patient){
        console.log(el, dni_contact, dni_patient)
        debugger
        if(el.checked){
            let body = { dni_contact, dni_patient }
            console.log("Body : ")
            console.log(body)
            let rs = await fetch(`/api/v1/ajax/contact`,{
                method:"PUT",
                headers:{"content-type": "application/json"},
                body:JSON.stringify(body)
            })
            let json = await rs.json()
            console.log("Response : ")
            console.log(json)
            if(json.success){
                for(let key in contacts){
                    let c = contacts[key]
                    if(dni_contact == c.dni){
                        contacts[key]["seguimiento"] = 2
                    }
                }
                generateCardContact(container_contact)
            }
        }
    }

    function initContacts(){
        const text_box_contacto = document.getElementById("text_box_contacto") //Obtener text box "Ingrese DNI"
        const button_agregar_contacto = document.getElementById("button_agregar_contacto") // Botón "Validar DNI"
        container_contact = document.getElementById("container_contact") // Contenedor de "Cards contactos" 
        generateCardContact(container_contact) //Convertir JSON en HTML Cards
        button_agregar_contacto.addEventListener("click", async ()=>{
            Swal.fire({imageUrl: 'https://i.pinimg.com/originals/7e/fc/2c/7efc2cb33ee4eb9d7625ca1eca702506.gif', title: "Espere un momento."})
            button_agregar_contacto.disabled = true
            let dni = text_box_contacto.value
            if(!Validation.isDNI(dni))
                return Swal.fire({icon: 'error', title: "DNI invalido", text: "Ingrese un DNI valido. El formato es 88888888."}) , button_agregar_contacto.disabled = false;
            let rs = await fetch(`/api/v1/ajax/contact?dni=${dni}`)
            Swal.close()
            let json = await rs.json()
            console.log(contacts)
            console.log("Resultado AJAX : ", json.data)
            if(json.success){
                //contacts[json.data.dni] = json.data
                countInputsNoneContact++
                let key = "none"+countInputsNoneContact
                add_contact(key, json.data)
                console.log("Despues de agregar", contacts)
                //generateCardContact(container_contact)
            }
            button_agregar_contacto.disabled = false
        })
    }
    
</script>
<script>
    const Validation ={
        isDNI: (_dni) => new RegExp("^[0-9]{8}$").test(_dni),
    }

    window.onload  = ()=>{
        init_treatments()
        initContacts()
        const scroll = document.getElementById("containet_form_check")
        scroll.parentNode.scrollTo(scroll.scrollWidth, 0)


        window.onkeypress = (event)=>{
            //debugger
            //console.log(event.keyCode == 13)
            if(event.keyCode == 13)
                event.preventDefault()
        }
    }


    function submitFormCustom(){
        
        event.preventDefault()
        saveStatusContacts()
        //console.log(contacts)
        saveState()
        let prefix = 'input_tra'
        let i_treatments = 0
        
        for(let key in treatments){
            let treatment = treatments[key]
            let type = treatment.type
            let name = treatment.name
            let init = treatment.init
            let finish = treatment.finish
            let observation = treatment.observation
           
            //i_treatments+=validateInputBlackNull(`${prefix}_${key}_obs`, observation, "Observación no definido", "Porfavor defina la observación (Rango de horas para tomar el medicamento y mas).") 
            //i_treatments+=validateInputBlackNull(`${prefix}_${key}_to`, finish, "Fecha de fin de tratamiento no definido", "Porfavor defina una fecha para el tratamiento tratamiento a seguir.") 
            i_treatments+=validateInputBlackNull(`${prefix}_${key}_from`, init, "Fecha inicial de tratamiento no definido", "Porfavor defina una fecha para el tratamiento tratamiento a seguir.") 
            i_treatments+=validateInputBlackNull(`${prefix}_${key}_name`, name, "Nombre de tratamiento no definido", "Porfavor defina el nombre de tratamiento a seguir.") 
            i_treatments+=validateInputBlackNull(`${prefix}_${key}_type`, type, "Tipo de tratamiento no definido", "Porfavor defina el tipo de tratamiento a seguir.") 
        }
        
        if(i_treatments == 0)
            document.getElementById("form").submit()
    }



    function validateInputBlackNull(id, value, title_error, message_error){
        if(value == "" || value == null){
            document.getElementById(id).focus()
            document.getElementById(id).classList.add("error_input")
            Swal.fire({
                icon: 'error',
                title: title_error,
                text: message_error,
            })
            return 1
        }
        return 0
    }
</script>